# 网络信息服务配置IISConfig
本篇主要记录如何在云服务器上安装并配置网络信息服务(Internet Information Services，简称IIS)

### 什么是IIS？
IIS顾名思义指的是微软提供的互联网基本服务，具体的说，这是一套Web服务器组件，其中包括

* Web服务器: 用来支持网页浏览
* FTP服务器：用来支持文件传输
* NNTP服务器：用来支持新闻服务
* SMTP服务器：用来支持邮件发送服务

部署网页主要用到的是Web服务器功能。

通俗的讲，IIS可视为网页应用管理器。将网页应用程序文件添加到IIS中就能实现部署、维护等一站式管理。

### 如何安装IIS？
IIS默认是不安装的，但在Windows系统中存在IIS的安装包，所以不用单独下载。

在Windows Server中，安装IIS需要跟随以下步骤：

* 打开Server Manager，在主页中选择添加角色和功能(Add roles and featrues)
* 在安装类型步骤中选择“基于角色或基于功能的安装”，点击下一步
* 在服务器选择步骤中选择当前服务器，点击下一步
* 在服务器类型选择步骤中选择Web Server(IIS)，按需选择具体需要安装的组件，也可以以后回来添加
* 在服务器类型选择步骤中的Web Server(IIS)一定记得勾选安装管理工具(Management tools)，点击下一步
* 在功能选择步骤中选择.NET Framework 4.5，点击下一步
* 在确认面板中点击下一步安装

一般来说，安装都能成功。安装过程中报错的原因主要有：

* 在安装.NET Framework 4.5的同时自定义安装了.NET Framework 3.5的其他组件，解决方案为仅安装4.5和3.5
* 选择了冲突或有BUG的组件，解决方案为先按照默认勾选安装，再挨个安装想添加的组件，选择错误源
* 有残留于内存的其他设置错误，解决方案为重启服务器

### 如何配置安装成功的IIS？
首先确保安装了.NET Framework 4.5下的ASP.NET组件，如果IIS右侧应用程序池(Application pool)中没有ASP.NET的分类，则说明未安装ASP.NET组件。返回Server Manager中重新添加Features，选择.NET Framework 4.5下的ASP.NET组件即可修复。

要想在IIS中部署ASP.NET开发的网页应用，应用程序池中必须有

* .NET 4.5
* .NET 4.5 Classic
* DefaultAppPool(官方默认自带的示例)

FTP服务器组件为可选，随时在Server Manager中添加安装。

### 什么是应用程序池？
应用程序池是将一个或多个应用程序链接到一个或多个工作进程集合的配置。

不同的Web应用如果使用不同的AppPool，则Pool与Pool之间不同的设置将无法影响对方的应用。

通俗的说，应用程序池是一系列设置，如.NET授权、.NET用户、错误页面、连接字符串等。

### 如何配置应用程序池？

配置应用程序池是配置IIS的一部分。每当我们新添加一个网页应用到IIS中，一般都默认为该应用新建一个AppPool。

共享一个Pool则意味着共享所有之前提到的配置，包括数据库等，所以没关系的应用都用自己独立的设置。

以默认网页的应用程序池为例，我们需要进行如下设置：

* 右键默认程序池，选择Basic Settings
* 确保.NET CLR版本为 v4.0.xxxxx
* 确保管道模式为集成(Integrated)
* 确认以上更改后，再次右键默认程序池，选择高级设置(Advanced Settings)
* 找到标识(Identify)，将值设为Local System(为本地数据库做准备)
* 回到站点功能视图，点击IIS类下的ASP打开配置
* 在"行为(Behavior)"中找到启用父路径(Enable Parent Path)，将值设为True

在右侧Connection目录中：

展开服务器 => 站点(Sites) => 右键Default Web Site => 选择Manage WebSite => 浏览网页

如果能够打开网页并看到IIS的官方主页，则说明配置成功。

### 如何将Web应用部署到IIS中？
IIS的核心功能就是托管网页应用。将网页应用部署到IIS上是托管应用的第一步。部署网页跟随以下步骤：

1. 右键左侧功能树中的"站点"，选择"添加网页"
2. 输入网页名，一般与申请的域名相同，即XXX.com
3. 选择应用程序池，默认自动为网页新建一个应用程序池
4. 设置网页应用的物理路径，即定位已发布的网页应用的路径
5. 将Connection As设为为任何授权用户开放链接
6. 绑定信息暂且留空，端口随意设置，在解决了域名与DNS解析后再回来设置

至此，一个Web应用就部署完毕。可以通过点击右侧菜单中的*:端口(http)连接进行本地访问。如果能以LocalHost打开网页则说明基本部署成功。

### 无法本地主持服务(打不卡网页)，是怎么回事？
原因有很多，多半是授权问题。如果Windows用户自身都无法访问那么网络用户更无法访问。解决权限问题跟随以下步骤：

1. 右键添加的网页，选择"编辑权限"
2. 将文件夹属性改为非只读
3. 在属性框中选择"安全"选项卡
4. 点击编辑，添加一个EVERYONE的用户，并赋予其所有权限
5. 将EVERYONE用户添加进用户组

至此，网页基本部署成功。

暂时想到这么多，最后更新2018/04/17
