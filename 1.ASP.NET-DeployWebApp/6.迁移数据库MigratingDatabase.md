# 迁移数据库MigratingDatabase
本篇记录了将本地数据库数据迁移到云服务器数据库的方法

### 什么是数据库迁移？
数据库迁移指将整个数据库从一个服务器完整转移到另一个服务器，数据库迁移包括数据库模型迁移和数据迁移两部分。

### 什么是数据库模型？
迁移数据库数据之前必须先迁移数据库模型，即容纳数据的"容器"。

数据库模型即指领域模型(Domain Models)，详情请参阅另一个学习仓库Entity Framework https://bit.ly/2EDNMFM。

### 如何迁移数据库模型？
在Code first work flow开发模式下，每一次领域模型的更改都以Migration文件的方式记录。

Entity Framework可以将Migration文件转换为SQL查询语句，可在Package Manager中导出.sql文件。

在服务器中的SSMS中执行所有Migration文件转换的.sql文件即可获得最终的数据库模型。

### 如何导出迁移文件转换的.sql文件？
打开Package Manager，按需执行以下命令：

* 将所有迁移文件转化为Sql文件：Update-Database -Script -SourceMigration:0
* 将目标范围迁移文件转化为Sql文件：Update-Database -Script -SourceMigration:[Migr1] -TargetMigration:[Migr2]

执行完毕则会弹出转换的.sql文件，保存即可。

### 我中途接手更新数据库模型的工作，如何知道数据库模型更新到哪一个迁移文件？
在目标(服务器)SQL Server中，展开目标数据库 => 表 => MigrationHistory，最后一条记录即是最后同步的迁移文件。

### Migration文件夹中配置文件中的Seed()方法填充的数据是否会被包含在转换的.sql文件中一起迁移到目标数据库？
不会。配置文件Configuration.cs会直接被忽略。但迁移文件中包含的SQL语句则会被保留到转换的.sql文件中。

### 如何将项目数据库中已填充的数据迁移到目标数据库？
在目标数据库执行了数据库模型迁移后才能迁移数据。根据原始数据库保存的位置有不同的迁移方法：

#### 从本地项目.mdf镜像数据库文件中迁移数据
在建立数据库之前如果不特别修改Web.config或App.config中的ConnectionString，ASP.NET默认建立一个本地.mdf镜像数据库文件。

#### 从本地SQL Server中迁移数据
