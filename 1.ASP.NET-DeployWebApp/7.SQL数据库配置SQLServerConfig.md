# SQL数据库配置SQLServerConfig
本篇记录了能让SQL Server作为网页数据来源正常工作的配置

### 为什么要配置SQL Server？
数据库是为储存数据而设计，其中很重要的两个考量是安全性和可访问性。一个数据库首先要可以被访问，才能为应用的核心功能提供支持，同时还要保证数据的安全。因为一旦数据被轻易非法篡改，也将影响应用的核心功能。

配置的主要目的为两个：

* 让应用可以访问数据
* 保证数据的安全

### 如何设置才能让应用正确访问数据库？
应用访问数据库的方法是由连接字符串(ConnectionString)定义，即定义了数据库的位置、权限等。但在之前，必须先进行一系列配置，让数据库处于"可连接状态"，即启用数据库的远程连接。

### 什么是远程连接？
顾名思义，远程连接指数据库可被远程调用。如用户在家通过用户端访问应用程序的数据库、开发者在家用SSMS连接公司服务器中的SQL Server，都是数据库的远程连接。

### 如何开启SQL Server的远程连接？
SQL Server 2008默认是不允许远程连接的，如果想要用户通过应用访问数据库，或在本地用SSMS连接云服务器上的SQL Server 2008数据库，需要在SSMS和SQL Server Manager中进行配置。

首先需要在SSMS进行设置，步骤如下：

1. 使用管理员权限登陆SSMS
2. 右键数据库，选择属性，在选择页中选择"连接"界面
3. 在右侧选项面板勾选"允许远程连接到此服务器"
4. 回到SSMS主页面，再次右键数据库，选择"方面"
5. 在"方面"属性中，选则下拉菜单到"服务器配置"
6. 将“RemoteAccessEnabled”属性设为"True"，点"确定"

然后需要在SQL Server Manager中进行设置，步骤如下：

1. 使用管理员权限打开SQL Server Manager
2. 选择左侧的"SQL Server Services"，确保右侧的"SQL Server"以及"SQL Server Browser"正在运行
3. 展开左侧的sql server网络配置，选择其下的sqlexpress的协议
4. 在右侧确保除了VIA以外其他所有项目都已启用
5. 右键TCP/IP协议，选择属性，选择IP地址选项卡，设置TCP的端口为“1433”

此时SSMS和SQL Server Manager配置完毕。理论上，在正确的连接字符串配置下，应用可以正常访问数据库。

### 如何保证数据库的安全？
权限设置是最基本的保证数据库安全的方法。在安装SQL Server 2008 R2时，默认选择数据库权限为Windows权限，即只要登陆了Windows操作系统的用户都获得数据库的授权。换句话说，只有让所有用户和其他开发者获得远程访问服务器的Windows操作系统的权限，才能让应用访问数据库，即实现应用的功能。

但这显然是不可能的。服务器操作系的权限不可能轻易暴露给任何普通用户。这种情况下，如果还要保证应用程序的数据库能够被访问，就需要特别向用户发放数据库的访问权限而不是整个操作系统的权限。

向用户发放访问数据库的权限即开放一个授权的账号，将这个账号写进连接字符串中，即这个应用的用户都能获得数据库的访问权限，实现应用程序的数据库功能，同时还保证了服务器操作系统的安全。

开放授权账号的步骤如下：

1. 以管理员身份登陆SSMS
2. 登录后，右键选择"属性"，左侧选择"安全性"，选中右侧的“SQL Server 和 Windows 身份验证模式”
3. 在左侧展开"安全性"=>"登录名"，右键sa账号选择属性
4. 左侧的"服务器角色"和"用户映射"能够详细设置这个账号在服务器中的其他权限，按需选择
5. 点击左侧的"状态"选项
6. 在右侧选择授予该账号能使用数据库引擎和启用其登陆权限

退出SSMS,尝试以授权账号重新登陆SSMS，如果登陆成功，则说明获得访问数据库授权的账号建成。

接下来只用将这个账号写入连接字符串即可让应用程序获得访问数据库的权限。

暂时想到这么多，最后更新2018/04/22
